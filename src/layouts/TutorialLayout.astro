---
/**
 * æ•™ç¨‹æ–‡æ¡£å¸ƒå±€æ¨¡æ¿
 * ç®€çº¦æ´»æ³¼é£æ ¼ï¼Œé¡¶éƒ¨ Bannerï¼ˆæ”¯æŒå°é¢å›¾ï¼‰+ å³ä¾§æµ®åŠ¨ç›®å½• + ç™½è‰²å†…å®¹åŒºåŸŸ
 */
import BaseLayout from './BaseLayout.astro';
import TutorialTOC from '../components/TutorialTOC.astro';
import TagList from '../components/TagList.astro';
import Breadcrumb from '../components/Breadcrumb.astro';
import ImageLightbox from '../components/ImageLightbox.astro';

interface Props {
  frontmatter: {
    title: string;
    description?: string;
    date: Date;
    updatedDate?: Date;
    tags?: string[];
    toc?: boolean;
    cover?: string;
    author?: string;
    difficulty?: 'beginner' | 'intermediate' | 'advanced';
    readingTime?: number;
    series?: string;
    order?: number;
    template?: string;
  };
  headings: { depth: number; slug: string; text: string }[];
}

const { frontmatter, headings } = Astro.props;
const { 
  title, 
  description, 
  date, 
  tags = [], 
  toc = true, 
  cover, 
  author = 'åŒ¿å',
  series,
  template = 'tutorial',
} = frontmatter;

// ç¡®ä¿ baseUrl ä»¥æ–œæ ç»“å°¾
const rawBaseUrl = import.meta.env.BASE_URL;
const baseUrl = rawBaseUrl.endsWith('/') ? rawBaseUrl : `${rawBaseUrl}/`;

// é»˜è®¤å°é¢å›¾ï¼ˆéœ€è¦åŠ ä¸Š baseUrl å‰ç¼€ï¼‰
const defaultCover = `${baseUrl}img/default.jpg`;

// Banner å°é¢å›¾ï¼šä¼˜å…ˆä½¿ç”¨ frontmatter.coverï¼Œè‡ªå®šä¹‰å°é¢ï¼›å¦åˆ™ä½¿ç”¨é»˜è®¤å›¾ç‰‡
// å¦‚æœ cover ä»¥ / å¼€å¤´ï¼Œéœ€è¦åŠ ä¸Š baseUrl å‰ç¼€
const bannerImageSrc = cover 
  ? (cover.startsWith('/') ? `${baseUrl.slice(0, -1)}${cover}` : cover)
  : defaultCover;

// æ ¼å¼åŒ–æ—¥æœŸ
const formatDate = (d: Date) => {
  return new Date(d).toLocaleDateString('zh-CN', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};

// ä» URL è·¯å¾„ä¸­æå–å½“å‰é¡µé¢çš„ slug
const pathname = Astro.url.pathname;
const currentSlug = pathname.split('/posts/')[1]?.replace(/\/$/, '') || '';

// é¢åŒ…å±‘å¯¼èˆª
const breadcrumbItems = [
  { label: 'é¦–é¡µ', href: baseUrl },
  { label: 'æ–‡ç« ', href: `${baseUrl}posts/` },
  { label: title }, // å½“å‰é¡µé¢æ ‡é¢˜ï¼ˆæ— é“¾æ¥ï¼‰
];
---

<BaseLayout title={title} description={description} ogImage={cover}>
  <!-- é¡¶éƒ¨ Banner åŒºåŸŸï¼ˆå¢å¤§é«˜åº¦ï¼‰ -->
  <div class="relative w-full min-h-[360px] md:min-h-[360px] flex items-center justify-center overflow-hidden">
    <!-- Banner èƒŒæ™¯å›¾ï¼ˆæ”¯æŒè‡ªå®šä¹‰å°é¢ï¼Œé»˜è®¤ä¸º default.jpgï¼‰ -->
    <img id="banner-img" src={bannerImageSrc} alt={title} class="absolute inset-0 w-full h-full object-cover scale-[1.02]" loading="lazy" crossorigin="anonymous" />
    
    <!-- Banner å†…å®¹ï¼šæ ‡é¢˜å’Œæè¿°ï¼ˆé»˜è®¤ç™½è‰²æ–‡å­—ï¼Œè„šæœ¬ä¼šæ ¹æ®å›¾ç‰‡äº®åº¦åŠ¨æ€åˆ‡æ¢ï¼‰ -->
    <div id="banner-content" class="relative z-10 text-center py-8 px-4 max-w-[1400px] mb-10 banner-text-light">
      <h1 class="banner-title text-4xl md:text-5xl font-bold mb-3 leading-tight">{title}</h1>
      {description && (
        <p class="banner-desc text-xl leading-relaxed">{description}</p>
      )}
    </div>
            </div>

  <!-- é¡¶éƒ¨æ‚¬æµ®å¯¼èˆªæ ï¼ˆé¢åŒ…å±‘ + æ ‡é¢˜ï¼Œä½¿ç”¨ Tailwind å®ç°æ ·å¼ä¸åŠ¨æ•ˆï¼‰ -->
  <div
    id="tutorial-top-nav"
    class="fixed top-0 left-0 right-0 z-40 pointer-events-none -translate-y-full opacity-0 transition-all duration-200 ease-out"
  >
    <div class="max-w-[1400px] mx-auto mt-2 p-4">
      <div
        class=" pointer-events-auto gap-4 px-6 py-4 rounded-full bg-white/95 shadow-[0_10px_30px_rgba(0,0,0,0.08)]"
      >
        <div class="flex items-center gap-3 text-[var(--color-text-muted)]">
          <Breadcrumb items={breadcrumbItems} currentSlug={currentSlug} currentTitle={title} />
        </div>
      </div>
    </div>
  </div>

  <!-- ä¸»ä½“å†…å®¹åŒºåŸŸ -->
  <div class="relative mx-auto px-4">
    <!-- å³ä¾§æµ®åŠ¨ç›®å½• -->
    {toc && headings.length > 0 && (
      <aside class="tutorial-toc-sidebar">
        <TutorialTOC headings={headings} />
      </aside>
          )}
          
    <!-- ç™½è‰²å†…å®¹å¡ç‰‡ï¼ˆä¸Šä¸‹åœ†è§’ï¼‰ -->
    <div class="bg-white rounded-3xl -mt-[120px] relative z-20  max-w-[1400px] mx-auto shadow-[0_-10px_40px_rgba(0,0,0,0.05)]">
      <!-- é¢åŒ…å±‘å¯¼èˆªï¼ˆç”¨äºæ§åˆ¶é¡¶éƒ¨æ‚¬æµ®å¯¼èˆªçš„å‡ºç°æ—¶æœºï¼‰ -->
      <div id="tutorial-breadcrumb" class="px-8 pt-6">
        <Breadcrumb items={breadcrumbItems} currentSlug={currentSlug} currentTitle={title} />
      </div>

      <article class="px-8 pb-12 md:px-12 md:pb-16">
          <!-- å…ƒä¿¡æ¯ï¼ˆæ°´å¹³æ•´ä½“å±…ä¸­ï¼‰ -->
         <div class="relative mt-6 mb-12">
           <div class="flex flex-col items-center">
            <!-- ç¬¬ä¸€è¡Œï¼šæ—¶é—´ã€ç±»å‹ã€ç³»åˆ—ã€ä½œè€… -->
            <div class="flex flex-wrap justify-center gap-6 items-center text-base text-[var(--color-text-secondary)]">
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4 text-[var(--color-text-muted)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span>{formatDate(date)}</span>
              </div>
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4 text-[var(--color-text-muted)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                </svg>
                <span>æ•™ç¨‹</span>
              </div>
              {series && (
                <div class="flex items-center gap-2">
                  <svg class="w-4 h-4 text-[var(--color-text-muted)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                  </svg>
                  <span>{series}</span>
                </div>
              )}
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4 text-[var(--color-text-muted)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <span>{author}</span>
              </div>
            </div>
            <!-- ç¬¬äºŒè¡Œï¼šæ ‡ç­¾ -->
            {tags.length > 0 && (
              <div class="pt-4 w-full flex justify-center">
                <TagList tags={tags} />
                </div>
              )}
            </div>
          </div>

        <!-- æ–‡ç« æ­£æ–‡ -->
        <div class="prose prose-base max-w-none tutorial-content" data-lightbox-container data-base-url={baseUrl}>
          <slot />
        </div>
      </article>
    </div>

    <!-- åº•éƒ¨å¯¼èˆªï¼ˆä¸å†…å®¹å¡ç‰‡åŒçº§ï¼‰ -->
    <footer class="mt-10 pb-10 max-w-[1400px] mx-auto flex justify-start">
      <a 
        href={`${baseUrl}posts`} 
        class="footer-back-link text-lg inline-flex items-center gap-2 px-5 "
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <!-- å‘å·¦ç®­å¤´ -->
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7 7-7M3 12h18" />
        </svg>
        è¿”å›æ–‡ç« åˆ—è¡¨
      </a>
    </footer>
  </div>
</BaseLayout>

<!-- å›¾ç‰‡é¢„è§ˆå¼¹çª—ç»„ä»¶ -->
<ImageLightbox />

<style>
  /* ===== æ— æ³•ç”¨ Tailwind æ›¿æ¢çš„æ ·å¼ ===== */

  /* Banner æ–‡å­—é¢œè‰²ï¼ˆæ ¹æ®å›¾ç‰‡äº®åº¦åŠ¨æ€åˆ‡æ¢ï¼‰ */
  .banner-text-dark .banner-title {
    color: var(--color-text);
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
  }
  .banner-text-dark .banner-desc {
    color: var(--color-text);
  }

  .banner-text-light .banner-title {
    color: white;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
  }
  .banner-text-light .banner-desc {
    color: rgba(255, 255, 255, 0.9);
    text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
  }

  /* å³ä¾§æµ®åŠ¨ç›®å½•ï¼ˆå›ºå®šå®šä½ + å‚ç›´å±…ä¸­ï¼‰ */
  .tutorial-toc-sidebar {
    display: none;
  }

  @media (min-width: 1280px) {
    .tutorial-toc-sidebar {
      display: block;
      position: fixed;
      right: 24px;
      top: 50%;
      transform: translateY(-50%);
      width: 240px;
      z-index: 50;
    }
  }

  /* ===== æ–‡ç« å†…å®¹ä¼ªå…ƒç´ æ ·å¼ ===== */
  .tutorial-content :global(h2) {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border-bottom: 2px dashed var(--color-border); /* ä½¿ç”¨è™šçº¿æ ·å¼ */
  }

  .tutorial-content :global(h3) {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    /* ä»…æ–‡å­—éƒ¨åˆ†çš„è“è‰²ä¸‹åˆ’çº¿ï¼ˆä½¿ç”¨ text-decoration æ§åˆ¶ï¼‰ */
    text-decoration-line: underline;
    text-decoration-color: var(--color-blue);
    text-decoration-thickness: 2px;
    text-underline-offset: 4px;
  }

  /* æ ‡é¢˜ä¸‹é¢çš„æ­£æ–‡å†…å®¹æ¯”æ ‡é¢˜å†å¤šç¼©è¿›ä¸€äº› */
  /* æ³¨æ„ï¼šblockquote ä¸å‚ä¸æ­¤è§„åˆ™ï¼Œå› ä¸ºå®ƒé€šå¸¸ç´§è·Ÿåœ¨ h2 åé¢ä½œä¸ºç›®æ ‡è¯´æ˜ */
  .tutorial-content :global(h3 ~ p),
  .tutorial-content :global(h3 ~ ol),
  .tutorial-content :global(h3 ~ ul),
  .tutorial-content :global(h3 ~ pre),
  .tutorial-content :global(h3 ~ table) {
    margin-left: 1.5rem;
  }
  
  /* h2 åé¢ç´§è·Ÿçš„ blockquote ä½¿ç”¨ :has() é‡ç½®ç¼©è¿› */
  .tutorial-content :global(h2 + blockquote) {
    margin-left: 0;
  }

  /* ç§»é™¤è¡Œå†…ä»£ç çš„å¼•å·ï¼ˆè¦†ç›– Tailwind Typography é»˜è®¤æ ·å¼ï¼‰ */
  .tutorial-content :global(:not(pre) > code::before),
  .tutorial-content :global(:not(pre) > code::after) {
    content: '' !important;
  }
 
  /* æ­¥éª¤åˆ—è¡¨ï¼ˆCSS è®¡æ•°å™¨ + è“è‰²åœ†å½¢ç¼–å· + æ—¶é—´çº¿è™šçº¿ï¼‰ */
  .tutorial-content :global(ol) {
    counter-reset: step-counter;
    list-style: none;
    padding-left: 0;
  }
  
  .tutorial-content :global(ol > li) {
    counter-increment: step-counter;
    position: relative;
    padding-left: 2.5rem;

  }
  
  /* åœ†å½¢åºå· */
  .tutorial-content :global(ol > li::before) {
    content: counter(step-counter);
    position: absolute;
    left: 0;
    top: 0;
    width: 2rem;
    height: 2rem;
    background: var(--color-blue);
    color: #ffffff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    font-weight: 600;
    z-index: 1; /* ç¡®ä¿åœ†å½¢åœ¨è™šçº¿ä¸Šæ–¹ */
  }

  /* æ—¶é—´çº¿è™šçº¿ï¼ˆè¿æ¥åœ†å½¢åºå·ï¼‰ */
  .tutorial-content :global(ol > li::after) {
    content: '';
    position: absolute;
    left: calc(1rem - 1px); /* åœ†å½¢ä¸­å¿ƒä½ç½® (2rem / 2 - 1px) */
    top: 2rem; /* ä»åœ†å½¢åº•éƒ¨å¼€å§‹ */
    width: 2px;
    height: calc(100% - 1rem); /* å»¶ä¼¸åˆ°ä¸‹ä¸€ä¸ªåœ†å½¢é¡¶éƒ¨é™„è¿‘ */
    background: repeating-linear-gradient(
      to bottom,
      var(--color-blue) 0,
      var(--color-blue) 4px,
      transparent 4px,
      transparent 8px
    );
  }

  /* æœ€åä¸€ä¸ªåˆ—è¡¨é¡¹ä¸æ˜¾ç¤ºè™šçº¿ */
  .tutorial-content :global(ol > li:last-child::after) {
    display: none;
  }

  /* å­çº§æœ‰åºåˆ—è¡¨ï¼šä½¿ç”¨å°å†™ç½—é©¬æ•°å­—ï¼Œè“è‰²æ–‡å­—ï¼Œæ— èƒŒæ™¯å¡«å…… */
  .tutorial-content :global(ol ol) {
    counter-reset: none;
    list-style-type: lower-roman;
    padding-left: 1.5rem;
  }

  .tutorial-content :global(ol ol > li) {
    padding-left: 0;
    position: static;
    counter-increment: none; /* å­çº§åˆ—è¡¨ä¸å¢åŠ è®¡æ•°å™¨ */
  }

  .tutorial-content :global(ol ol > li::before) {
    content: none;
  }

  /* å­çº§æœ‰åºåˆ—è¡¨çš„åºå·é¢œè‰²ä¸ºè“è‰²ï¼Œä»…ä½œç”¨äº marker æœ¬èº« */
  .tutorial-content :global(ol ol > li::marker) {
    color: var(--color-blue);
    font-weight: 500;
  }

  /* æ— åºåˆ—è¡¨é¡¹ç›®ç¬¦å·ä¸ºè“è‰²ä¸”æ›´å¤§ */
  .tutorial-content :global(ul > li::marker) {
    color: var(--color-blue);
    font-size: 1.2em;
  }

  /* å­çº§æ— åºåˆ—è¡¨é¡¹ç›®ç¬¦å·ä¸ºç©ºå¿ƒåœ†ç‚¹ */
  .tutorial-content :global(ul ul) {
    list-style-type: circle;
  }

  .tutorial-content :global(ul ul > li::marker) {
    color: var(--color-blue);
  }

  /* æ— åºåˆ—è¡¨æ•´ä½“ä¸å‰ä¸€æ®µè½çš„é—´è·æ›´å°ä¸€äº› */
  .tutorial-content :global(ul) {
    margin-top: 0.25rem;
  }

  /* åˆ—è¡¨é¡¹ä¸­çš„æ®µè½è¡Œé—´è·æ›´ç´§å‡‘ä¸€äº› */
  .tutorial-content :global(li > p) {
    margin-bottom: 0.2rem;
    margin-top:0.2rem;
  }

  /* æ— åºåˆ—è¡¨è¡Œé—´è· */
  .tutorial-content :global(ul > li) {
  }

  /* åº•éƒ¨è¿”å›æŒ‰é’®ï¼šæ‚¬æµ®æ—¶å˜æ©™è‰²å¹¶ç•¥å¾®æ”¾å¤§ï¼ˆæ–‡å­— + å›¾æ ‡ä¸€èµ·æ”¾å¤§ï¼‰ */
  .footer-back-link {
    color: var(--color-text-secondary);
    transition: color 0.2s ease, transform 0.2s ease;
    transform-origin: left center;
  }

  .footer-back-link:hover {
    color: var(--color-orange);
    transform: scale(1.05);
  }

  /* ===== å¼•ç”¨å—æ ·å¼ï¼ˆNotion Callout é£æ ¼ï¼‰ ===== */
  .tutorial-content :global(blockquote) {
    position: relative;
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    margin-top: -1rem;
    background: linear-gradient(135deg, rgba(245, 130, 32, 0.08) 0%, rgba(245, 130, 32, 0.04) 100%);
    border: 1px solid rgba(245, 130, 32, 0.2);
    border-radius: 12px;
    border-left: none; /* å»æ‰é»˜è®¤å·¦è¾¹æ¡† */
    font-style: normal; /* å»æ‰æ–œä½“ */
    quotes: none;
  }

  /* Callout å›¾æ ‡ï¼ˆä½¿ç”¨ ::before ä¼ªå…ƒç´ ï¼‰ */
  .tutorial-content :global(blockquote::before) {
    content: 'ğŸ“Œ';
    font-size: 1rem;
    line-height: 1.5;
    flex-shrink: 0;
  }

  /* Callout å†…å®¹æ ·å¼ */
  .tutorial-content :global(blockquote p) {
    margin: 0;
    color: var(--color-text);
    font-size: 1rem;
    line-height: 1.5;
  }

  /* Callout å†…åŠ ç²—æ–‡å­—ä¸ºæ©™è‰² */
  .tutorial-content :global(blockquote strong) {
    color: var(--color-orange);
  }
  

  /* ===== å›¾ç‰‡æ ·å¼ ===== */
  /* å•å¼ å›¾ç‰‡ï¼šå±…ä¸­æ˜¾ç¤ºï¼Œæœ€å¤§é«˜åº¦ 1000pxï¼Œæ— æŠ•å½± */
  .tutorial-content :global(img) {
    display: block;
    max-height: 1000px;
    width: auto;
    max-width: 100%;
    height: auto;
    margin-left: auto;
    margin-right: auto;
    object-fit: contain;
    box-shadow: none; /* åˆ é™¤å›¾ç‰‡æŠ•å½± */
  }

  /* å›¾ç‰‡å®¹å™¨ï¼ˆfigureï¼‰æ ·å¼ */
  .tutorial-content :global(figure.image-figure) {
    margin: 1.5rem auto;
    text-align: center;
  }

  /* å›¾ç‰‡æ³¨é‡Šæ ·å¼ï¼ˆfigcaptionï¼Œæ¥è‡ª alt æ–‡æœ¬ï¼‰ */
  .tutorial-content :global(figcaption.image-caption) {
    color: var(--color-text-muted);
    font-size: 1rem;
    font-style: italic;
    margin-top: 0.5rem;
    line-height: 1.5;
  }

  /* è¿ç»­å›¾ç‰‡å®¹å™¨ï¼šè‡ªåŠ¨å¤šåˆ—å¸ƒå±€ï¼ˆæœ€å¤š 3 åˆ—ï¼‰ */
  .tutorial-content :global(.image-group) {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(max(280px, calc((100% - 2rem) / 3)), 1fr));
    gap: 1.5rem;
    margin: 1.5rem 0;
    max-width: 100%;
  }

  /* å›¾ç‰‡ç»„å†…çš„ figure æ ·å¼ */
  .tutorial-content :global(.image-group figure.image-figure) {
    margin: 0;
  }

  /* å›¾ç‰‡ç»„å†…çš„å›¾ç‰‡æ ·å¼ */
  .tutorial-content :global(.image-group img) {
    width: 100%;
    height: auto;
    max-height: 1000px;
    object-fit: contain;
    margin: 0;
  }

  /* ===== ä»£ç å—æ ·å¼ ===== */
  /* ä»£ç å—åŒ…è£…å®¹å™¨ï¼ˆç”± JS åˆ›å»ºï¼‰ */
  .tutorial-content :global(.code-block-wrapper) {
    position: relative;
    border-radius: 16px;
    overflow: hidden;
    margin: 1rem 0;
  }

  .tutorial-content :global(pre) {
    position: relative;
    max-height: 600px; /* 800px - 60px å¤´éƒ¨é«˜åº¦ */
    overflow-y: auto;
    overflow-x: auto;
    margin: 0 !important;
    border-radius: 0 0 16px 16px !important;
  }

  /* ä»£ç å—å¤´éƒ¨ï¼ˆè¯­è¨€æ ‡ç­¾ + å¤åˆ¶æŒ‰é’®ï¼‰ */
  .tutorial-content :global(.code-header) {
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 1rem;
    background: rgba(22, 27, 34, 0.95);
    height: 2.5rem;
    box-sizing: border-box;
    z-index: 10;
    border-radius: 16px 16px 0 0;
  }

  /* ä»£ç å†…å®¹åŒºåŸŸ */
  .tutorial-content :global(pre code) {
    display: block;
  }

  .tutorial-content :global(.code-language) {
    font-size: 0.75rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.7);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .tutorial-content :global(.code-copy-btn) {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.25rem 0.5rem;
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .tutorial-content :global(.code-copy-btn:hover) {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.4);
    color: white;
  }

  .tutorial-content :global(.code-copy-btn.copied) {
    background: var(--color-green);
    border-color: var(--color-green);
    color: white;
  }

  .tutorial-content :global(.code-copy-btn svg) {
    width: 14px;
    height: 14px;
  }

  /* ===== ç‰¹å®šâ€œä½¿ç”¨æ•™ç¨‹â€èƒ¶å›ŠæŒ‰é’®é“¾æ¥æ ·å¼ ===== */
  .tutorial-content :global(a.tutorial-pill-link) {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.35rem 0.9rem;
    border-radius: 999px;
    background-color: rgba(0, 119, 255, 0.08);
    color: var(--color-blue);
    font-weight: 500;
    text-decoration: none;
    border: 1px solid rgba(0, 119, 255, 0.4);
    transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
  }

  .tutorial-content :global(a.tutorial-pill-link::after) {
    content: 'â†’';
    font-size: 1rem;
    display: inline-block;
    transform: translateY(1px);
  }

  .tutorial-content :global(a.tutorial-pill-link:hover) {
    background-color: rgba(0, 119, 255, 0.16);
  }

  .tutorial-content :global(a.tutorial-pill-link:active) {
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(0, 119, 255, 0.2);
  }

  /* ===== è§†é¢‘åµŒå…¥æ ·å¼ï¼ˆiframe / videoï¼‰ ===== */
  /* å®½å±è§†é¢‘å®¹å™¨ï¼šå“åº”å¼ 16:9 æ¯”ä¾‹ï¼Œå æ»¡æ­£æ–‡å®½åº¦ */
  .tutorial-content :global(.video-container) {
    position: relative;
    width: 100%;
    max-width: 1000px; /* æ›´å®½çš„æ˜¾ç¤ºåŒºåŸŸ */
    margin: 1.5rem auto;
    padding-bottom: 56.25%; /* 16:9 æ¯”ä¾‹ */
    height: 0;
    overflow: hidden;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    background: #000;
  }

  .tutorial-content :global(.video-container iframe),
  .tutorial-content :global(.video-container video) {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
    border-radius: 16px;
  }

  /* ç«–ç‰ˆè§†é¢‘å®¹å™¨ï¼ˆæŠ–éŸ³ç­‰çŸ­è§†é¢‘å¹³å°ï¼‰ */
  .tutorial-content :global(.video-container-vertical) {
    display: flex;
    justify-content: center;
    margin: 1.5rem auto;
  }

  .tutorial-content :global(.video-container-vertical iframe) {
    width: 360px;
    height: 640px; /* æŠ–éŸ³æ’­æ”¾å™¨æ¨èå°ºå¯¸ */
    border: none;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }

  /* ç§»åŠ¨ç«¯å“åº”å¼ */
  @media (max-width: 480px) {
    .tutorial-content :global(.video-container-vertical iframe) {
      width: 100%;
      height: auto;
      aspect-ratio: 9 / 16;
    }
  }

</style>

<script>
  /**
   * åˆ†æ Banner å›¾ç‰‡äº®åº¦ï¼Œè‡ªåŠ¨é€‰æ‹©æ–‡å­—é¢œè‰²
   * äº®åº¦é«˜ -> æ·±è‰²æ–‡å­—ï¼ˆbanner-text-darkï¼‰
   * äº®åº¦ä½ -> ç™½è‰²æ–‡å­—ï¼ˆbanner-text-lightï¼‰
   */
  function analyzeBannerBrightness() {
    const img = document.getElementById('banner-img') as HTMLImageElement;
    const content = document.getElementById('banner-content');
    
    if (!img || !content) return;

    // å›¾ç‰‡åŠ è½½å®Œæˆååˆ†æ
    const analyze = () => {
      try {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        if (!ctx) return;

        // é‡‡æ ·åŒºåŸŸï¼šå›¾ç‰‡ä¸­å¿ƒåŒºåŸŸï¼ˆæ ‡é¢˜æ‰€åœ¨ä½ç½®ï¼‰
        const sampleWidth = Math.min(img.naturalWidth, 400);
        const sampleHeight = Math.min(img.naturalHeight, 200);
        canvas.width = sampleWidth;
        canvas.height = sampleHeight;

        // ç»˜åˆ¶å›¾ç‰‡ä¸­å¿ƒåŒºåŸŸ
        const sx = (img.naturalWidth - sampleWidth) / 2;
        const sy = (img.naturalHeight - sampleHeight) / 2;
        ctx.drawImage(img, sx, sy, sampleWidth, sampleHeight, 0, 0, sampleWidth, sampleHeight);

        // è·å–åƒç´ æ•°æ®
        const imageData = ctx.getImageData(0, 0, sampleWidth, sampleHeight);
        const pixels = imageData.data;

        // è®¡ç®—å¹³å‡äº®åº¦ï¼ˆæ„ŸçŸ¥äº®åº¦å…¬å¼ï¼‰
        let totalBrightness = 0;
        const pixelCount = pixels.length / 4;

        for (let i = 0; i < pixels.length; i += 4) {
          const r = pixels[i];
          const g = pixels[i + 1];
          const b = pixels[i + 2];
          // æ„ŸçŸ¥äº®åº¦å…¬å¼
          const brightness = 0.299 * r + 0.587 * g + 0.114 * b;
          totalBrightness += brightness;
        }

        const avgBrightness = totalBrightness / pixelCount;

        // äº®åº¦é˜ˆå€¼ï¼š128ï¼ˆ0-255 çš„ä¸­é—´å€¼ï¼‰
        // äº®åº¦ > 128 -> å›¾ç‰‡åäº® -> ä½¿ç”¨æ·±è‰²æ–‡å­—
        // äº®åº¦ <= 128 -> å›¾ç‰‡åæš— -> ä½¿ç”¨ç™½è‰²æ–‡å­—ï¼ˆé»˜è®¤ï¼‰
        if (avgBrightness > 128) {
          content.classList.remove('banner-text-light');
          content.classList.add('banner-text-dark');
        } else {
          content.classList.remove('banner-text-dark');
          content.classList.add('banner-text-light');
        }
      } catch (e) {
        // è·¨åŸŸå›¾ç‰‡æ— æ³•åˆ†æï¼Œä¿æŒé»˜è®¤ç™½è‰²æ–‡å­—
        console.warn('æ— æ³•åˆ†æå›¾ç‰‡äº®åº¦ï¼Œä¿æŒé»˜è®¤ç™½è‰²æ–‡å­—');
      }
    };

    if (img.complete) {
      analyze();
    } else {
      img.addEventListener('load', analyze);
    }
  }

  // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
  document.addEventListener('DOMContentLoaded', analyzeBannerBrightness);
  // Astro é¡µé¢åˆ‡æ¢æ—¶ä¹Ÿæ‰§è¡Œ
  document.addEventListener('astro:page-load', analyzeBannerBrightness);

  /**
   * å°†å›¾ç‰‡åŒ…è£¹æˆ <figure>ï¼Œå¹¶ç”¨ alt æ–‡æœ¬ç”Ÿæˆ <figcaption> æ³¨é‡Š
   * æ”¯æŒå¤šç§å›¾ç‰‡ç»“æ„ï¼š
   * - <p><img></p> (æ ‡å‡† Markdown)
   * - <p><img><img></p> (è¿ç»­å›¾ç‰‡åœ¨åŒä¸€ä¸ª p å†…)
   * - ç›´æ¥çš„ <img> (Astro å›¾ç‰‡ç»„ä»¶)
   */
  function wrapImagesWithFigure() {
    const content = document.querySelector('.tutorial-content');
    if (!content) return;

    // å¤„ç†æ–¹å¼1ï¼š<p> å†…åªæœ‰ä¸€å¼ å›¾ç‰‡
    content.querySelectorAll('p > img:only-child').forEach(img => {
      const p = img.parentElement;
      if (!p || p.closest('.image-figure, .image-group')) return;
      
      const figure = createFigure(img as HTMLImageElement);
      p.parentNode?.replaceChild(figure, p);
    });

    // å¤„ç†æ–¹å¼2ï¼š<p> å†…æœ‰å¤šå¼ è¿ç»­å›¾ç‰‡ï¼ˆAstro å¯èƒ½ä¼šæŠŠè¿ç»­å›¾ç‰‡æ”¾åœ¨åŒä¸€ä¸ª p å†…ï¼‰
    content.querySelectorAll('p').forEach(p => {
      if (p.closest('.image-figure, .image-group')) return;
      
      const children = Array.from(p.childNodes);
      const imgs = Array.from(p.querySelectorAll('img'));
      
      // æ£€æŸ¥æ˜¯å¦åªåŒ…å«å›¾ç‰‡ï¼ˆå’Œå¯èƒ½çš„ç©ºç™½æ–‡æœ¬èŠ‚ç‚¹ï¼‰
      const nonEmptyChildren = children.filter(node => {
        if (node.nodeType === Node.TEXT_NODE) {
          return node.textContent?.trim() !== '';
        }
        return true;
      });
      
      if (imgs.length >= 2 && nonEmptyChildren.length === imgs.length) {
        // å¤šå¼ å›¾ç‰‡ï¼Œåˆ›å»ºå›¾ç‰‡ç»„
        const wrapper = document.createElement('div');
        wrapper.className = 'image-group';
        
        imgs.forEach(img => {
          const figure = createFigure(img as HTMLImageElement);
          wrapper.appendChild(figure);
        });
        
        p.parentNode?.replaceChild(wrapper, p);
      }
    });
  }

  /**
   * åˆ›å»º figure å…ƒç´ 
   */
  function createFigure(img: HTMLImageElement): HTMLElement {
    const figure = document.createElement('figure');
    figure.className = 'image-figure';
    
    // å…‹éš†å›¾ç‰‡åˆ° figure
    figure.appendChild(img.cloneNode(true));
    
    // å¦‚æœæœ‰ alt æ–‡æœ¬ï¼Œåˆ›å»º figcaption
    const altText = img.getAttribute('alt');
    if (altText && altText.trim()) {
      const caption = document.createElement('figcaption');
      caption.className = 'image-caption';
      caption.textContent = altText;
      figure.appendChild(caption);
    }
    
    return figure;
  }

  /**
   * è‡ªåŠ¨è¯†åˆ«è¿ç»­å›¾ç‰‡å¹¶åŒ…è£¹æˆå›¾ç‰‡ç»„ï¼ˆæœ€å¤š 3 åˆ—ï¼‰
   * è§„åˆ™ï¼š
   * - è¿ç»­çš„ <figure.image-figure> å…ƒç´ ä¼šè¢«åˆå¹¶æˆä¸€ä¸ª .image-group
   * - ä¸­é—´æœ‰å…¶ä»–å…ƒç´ åˆ™æ‰“æ–­åˆ†ç»„
   * - å•å¼ å›¾ç‰‡ä¿æŒåŸæ ·ï¼ˆå±…ä¸­æ˜¾ç¤ºï¼‰
   */
  function groupConsecutiveImages() {
    const content = document.querySelector('.tutorial-content');
    if (!content) return;

    // è·å–æ‰€æœ‰ç›´æ¥å­å…ƒç´ 
    let children = Array.from(content.children);
    let i = 0;

    while (i < children.length) {
      const current = children[i];
      
      // æ£€æŸ¥æ˜¯å¦æ˜¯å›¾ç‰‡ figureï¼ˆä¸”ä¸åœ¨ image-group å†…ï¼‰
      if (isImageFigure(current) && !current.closest('.image-group')) {
        // æ”¶é›†è¿ç»­çš„å›¾ç‰‡ figureï¼ˆæœ€å¤š 3 å¼ ï¼‰
        const imageGroup: Element[] = [current];
        let j = i + 1;
        
        while (j < children.length && imageGroup.length < 3) {
          const next = children[j];
          if (isImageFigure(next)) {
            imageGroup.push(next);
            j++;
          } else {
            break;
          }
        }

        // å¦‚æœæœ‰ 2 å¼ æˆ–ä»¥ä¸Šè¿ç»­å›¾ç‰‡ï¼Œåˆ›å»ºå›¾ç‰‡ç»„
        if (imageGroup.length >= 2) {
          const wrapper = document.createElement('div');
          wrapper.className = 'image-group';
          
          // åœ¨ç¬¬ä¸€ä¸ªå›¾ç‰‡å‰æ’å…¥ wrapper
          current.parentNode?.insertBefore(wrapper, current);
          
          // å°†æ‰€æœ‰ figure ç§»å…¥ wrapper
          imageGroup.forEach(figure => {
            wrapper.appendChild(figure);
          });

          // æ›´æ–° children æ•°ç»„å’Œç´¢å¼•
          children = Array.from(content.children);
          i = children.indexOf(wrapper) + 1;
        } else {
          i++;
        }
      } else {
        i++;
      }
    }
  }

  /**
   * åˆ¤æ–­å…ƒç´ æ˜¯å¦æ˜¯å›¾ç‰‡ figure
   */
  function isImageFigure(el: Element): boolean {
    return el.tagName === 'FIGURE' && el.classList.contains('image-figure');
  }

  /**
   * åˆå§‹åŒ–å›¾ç‰‡å¤„ç†ï¼šå…ˆåŒ…è£¹ figureï¼Œå†åˆ†ç»„
   */
  function initImageProcessing() {
    wrapImagesWithFigure();
    groupConsecutiveImages();
  }

  document.addEventListener('DOMContentLoaded', initImageProcessing);
  document.addEventListener('astro:page-load', initImageProcessing);

  /**
   * å½“é¡µé¢æ»šåŠ¨åˆ°é¢åŒ…å±‘ç¦»å¼€è§†å£æ—¶ï¼Œæ˜¾ç¤ºé¡¶éƒ¨æ‚¬æµ®å¯¼èˆªæ 
   */
  function setupFloatingTopNav() {
    const breadcrumb = document.getElementById('tutorial-breadcrumb');
    const topNav = document.getElementById('tutorial-top-nav');

    if (!breadcrumb || !topNav) return;

    const showClasses = ['translate-y-0', 'opacity-100'];
    const hideClasses = ['-translate-y-full', 'opacity-0'];

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          // å½“é¢åŒ…å±‘å®Œå…¨ç¦»å¼€è§†å£æ—¶æ˜¾ç¤ºé¡¶éƒ¨å¯¼èˆª
          if (entry.isIntersecting) {
            topNav.classList.remove(...showClasses);
            hideClasses.forEach((c) => topNav.classList.add(c));
          } else {
            topNav.classList.remove(...hideClasses);
            showClasses.forEach((c) => topNav.classList.add(c));
          }
        });
      },
      {
        root: null,
        threshold: 0,
      }
    );

    observer.observe(breadcrumb);
  }

  document.addEventListener('DOMContentLoaded', setupFloatingTopNav);
  document.addEventListener('astro:page-load', setupFloatingTopNav);

  /**
   * ===== ä»£ç å—å¤åˆ¶åŠŸèƒ½ =====
   */
  function initCodeBlockCopy() {
    const content = document.querySelector('.tutorial-content');
    if (!content) return;

    const codeBlocks = content.querySelectorAll('pre');
    
    codeBlocks.forEach(pre => {
      // é¿å…é‡å¤æ·»åŠ ï¼ˆæ£€æŸ¥æ˜¯å¦å·²ç»è¢«åŒ…è£…ï¼‰
      if (pre.parentElement?.classList.contains('code-block-wrapper')) return;

      // è·å–ä»£ç è¯­è¨€ï¼šä¼˜å…ˆä» class / data-language ä¸­æå–ï¼Œè€Œä¸æ˜¯ç”¨å›ºå®šçš„ "code"
      const code = pre.querySelector('code');
      let language = 'code';

      // 1) ä» <code> çš„ class æå–ï¼ˆlanguage-xxxï¼‰
      if (code) {
        const codeClasses = Array.from(code.classList);
        const langClass = codeClasses.find((c) => c.startsWith('language-'));
        if (langClass) {
          language = langClass.replace('language-', '');
        }
      }

      // 2) å¦‚æœè¿˜æ²¡æ‹¿åˆ°ï¼Œå†ä» <pre> æˆ– <code> çš„ data-language æå–ï¼ˆAstro/Shiki å¯èƒ½ä¼šåŠ è¿™ä¸ªï¼‰
      if (language === 'code') {
        const dataLang = (code?.getAttribute('data-language') || pre.getAttribute('data-language')) ?? '';
        if (dataLang) {
          language = dataLang;
        }
      }

      // 3) å…œåº•ï¼šæŠŠè¯­è¨€åè½¬æˆå¤§å†™ï¼Œä¾¿äºåœ¨å¤´éƒ¨å±•ç¤ºï¼ˆä¾‹å¦‚ json -> JSONï¼‰
      const languageLabel = language ? language.toUpperCase() : 'CODE';

      // åˆ›å»ºåŒ…è£…å®¹å™¨
      const wrapper = document.createElement('div');
      wrapper.className = 'code-block-wrapper';

      // åˆ›å»ºå¤´éƒ¨
      const header = document.createElement('div');
      header.className = 'code-header';
      header.innerHTML = `
        <span class="code-language">${languageLabel}</span>
        <button class="code-copy-btn" aria-label="å¤åˆ¶ä»£ç ">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
            <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
          </svg>
          <span>å¤åˆ¶</span>
        </button>
      `;

      // ç”¨ wrapper åŒ…è£… preï¼Œå¹¶æŠŠ header æ”¾åœ¨ pre å‰é¢
      pre.parentNode?.insertBefore(wrapper, pre);
      wrapper.appendChild(header);
      wrapper.appendChild(pre);

      // ç»‘å®šå¤åˆ¶äº‹ä»¶
      const copyBtn = header.querySelector('.code-copy-btn');
      copyBtn?.addEventListener('click', async () => {
        const codeText = code?.textContent || '';
        
        try {
          await navigator.clipboard.writeText(codeText);
          
          // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸçŠ¶æ€
          copyBtn.classList.add('copied');
          const btnText = copyBtn.querySelector('span');
          if (btnText) btnText.textContent = 'å·²å¤åˆ¶';
          
          // æ›´æ–°å›¾æ ‡ä¸ºå‹¾é€‰
          const svg = copyBtn.querySelector('svg');
          if (svg) {
            svg.innerHTML = '<path d="M20 6L9 17l-5-5"/>';
          }
          
          // 2ç§’åæ¢å¤
          setTimeout(() => {
            copyBtn.classList.remove('copied');
            if (btnText) btnText.textContent = 'å¤åˆ¶';
            if (svg) {
              svg.innerHTML = '<rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>';
            }
          }, 2000);
        } catch (err) {
          console.error('å¤åˆ¶å¤±è´¥:', err);
        }
      });
    });
  }

  document.addEventListener('DOMContentLoaded', initCodeBlockCopy);
  document.addEventListener('astro:page-load', initCodeBlockCopy);

  /**
   * ===== ä¿®å¤ Markdown å›¾ç‰‡è·¯å¾„ï¼ˆæ·»åŠ  BASE_URL å‰ç¼€ï¼‰ =====
   * Astro é»˜è®¤ä¸ä¼šè‡ªåŠ¨ç»™ Markdown ä¸­çš„å›¾ç‰‡è·¯å¾„åŠ  BASE_URL
   * éœ€è¦åœ¨å®¢æˆ·ç«¯åŠ¨æ€ä¿®å¤
   */
  function fixImagePaths() {
    const content = document.querySelector('.tutorial-content');
    if (!content) return;

    // ä» data å±æ€§è·å– BASE_URL
    const baseUrl = content.getAttribute('data-base-url') || '/';

    // ä¿®å¤æ‰€æœ‰å›¾ç‰‡è·¯å¾„
    content.querySelectorAll('img').forEach(img => {
      const src = img.getAttribute('src');
      if (!src) return;

      // è·³è¿‡å¤–é“¾å›¾ç‰‡
      if (/^https?:\/\//.test(src)) return;

      // è·³è¿‡å·²ç»åŒ…å« BASE_URL çš„è·¯å¾„ï¼ˆé¿å…é‡å¤ä¿®å¤ï¼‰
      if (baseUrl !== '/' && src.startsWith(baseUrl)) return;

      // è·³è¿‡ data: å’Œ blob: URL
      if (/^(data|blob):/.test(src)) return;

      // å¦‚æœæ˜¯ä»¥ / å¼€å¤´çš„ç»å¯¹è·¯å¾„ï¼Œæ·»åŠ  BASE_URL å‰ç¼€
      if (src.startsWith('/')) {
        const newSrc = baseUrl === '/' ? src : `${baseUrl}${src.slice(1)}`;
        img.setAttribute('src', newSrc);
      }
    });
  }

  document.addEventListener('DOMContentLoaded', fixImagePaths);
  document.addEventListener('astro:page-load', fixImagePaths);

  /**
   * ===== ä¿®å¤ Markdown å†…éƒ¨é“¾æ¥è·¯å¾„ï¼ˆæ·»åŠ  BASE_URL å‰ç¼€ï¼‰ =====
   * Astro é»˜è®¤ä¸ä¼šè‡ªåŠ¨ç»™ Markdown ä¸­çš„å†…éƒ¨é“¾æ¥åŠ  BASE_URL
   * éœ€è¦åœ¨å®¢æˆ·ç«¯åŠ¨æ€ä¿®å¤
   */
  function fixInternalLinks() {
    const content = document.querySelector('.tutorial-content');
    if (!content) return;

    // ä» data å±æ€§è·å– BASE_URL
    const baseUrl = content.getAttribute('data-base-url') || '/';

    // å¦‚æœ BASE_URL æ˜¯ /ï¼Œä¸éœ€è¦ä¿®å¤
    if (baseUrl === '/') return;

    // ä¿®å¤æ‰€æœ‰å†…éƒ¨é“¾æ¥
    content.querySelectorAll('a').forEach(link => {
      const href = link.getAttribute('href');
      if (!href) return;

      // è·³è¿‡å¤–é“¾
      if (/^https?:\/\//.test(href)) return;

      // è·³è¿‡é”šç‚¹é“¾æ¥
      if (href.startsWith('#')) return;

      // è·³è¿‡ mailto: å’Œ tel: é“¾æ¥
      if (/^(mailto|tel):/.test(href)) return;

      // è·³è¿‡å·²ç»åŒ…å« BASE_URL çš„è·¯å¾„
      if (href.startsWith(baseUrl)) return;

      // å¦‚æœæ˜¯ä»¥ / å¼€å¤´çš„ç»å¯¹è·¯å¾„ï¼Œæ·»åŠ  BASE_URL å‰ç¼€
      if (href.startsWith('/')) {
        const newHref = `${baseUrl}${href.slice(1)}`;
        link.setAttribute('href', newHref);
      }
    });
  }

  document.addEventListener('DOMContentLoaded', fixInternalLinks);
  document.addEventListener('astro:page-load', fixInternalLinks);

  /**
   * ===== å°†å¤–é“¾å’Œç‰¹å®šå†…é“¾æ¸²æŸ“ä¸ºèƒ¶å›ŠæŒ‰é’® =====
   * ç›®æ ‡ï¼š
   * 1. æ‰€æœ‰ https:// æˆ– http:// å¼€å¤´çš„å¤–éƒ¨é“¾æ¥ï¼ˆæ–°æ ‡ç­¾é¡µæ‰“å¼€ï¼‰
   * 2. ç‰¹å®šå†…éƒ¨é“¾æ¥ï¼ˆå¦‚æ•™ç¨‹è·³è½¬é“¾æ¥ï¼‰
   */
  function enhanceSpecialLinks() {
    const content = document.querySelector('.tutorial-content');
    if (!content) return;

    // åŒ¹é…æ‰€æœ‰å¤–é“¾ï¼ˆhttp:// æˆ– https:// å¼€å¤´ï¼‰
    const externalLinks = content.querySelectorAll<HTMLAnchorElement>('a[href^="http://"], a[href^="https://"]');

    externalLinks.forEach((link) => {
      if (link.classList.contains('tutorial-pill-link')) return;
      link.classList.add('tutorial-pill-link');
      // å¤–é“¾åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€
      link.setAttribute('target', '_blank');
      link.setAttribute('rel', 'noopener noreferrer');
    });

    // åŒ¹é…æ‰€æœ‰å†…éƒ¨æ–‡ç« é“¾æ¥ï¼ˆ/posts/ å¼€å¤´çš„é“¾æ¥ï¼‰
    const internalPillLinks = content.querySelectorAll<HTMLAnchorElement>(
      'a[href*="/posts/"]'
    );

    internalPillLinks.forEach((link) => {
      if (link.classList.contains('tutorial-pill-link')) return;
      // è·³è¿‡å¤–éƒ¨é“¾æ¥ï¼ˆå·²åœ¨ä¸Šé¢å¤„ç†ï¼‰
      const href = link.getAttribute('href') || '';
      if (href.startsWith('http://') || href.startsWith('https://')) return;
      
      link.classList.add('tutorial-pill-link');
      // å†…é“¾ä¸è®¾ç½® target="_blank"ï¼Œä¿æŒå½“å‰é¡µé¢è·³è½¬
    });
  }

  document.addEventListener('DOMContentLoaded', enhanceSpecialLinks);
  document.addEventListener('astro:page-load', enhanceSpecialLinks);
</script>
