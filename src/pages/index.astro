---
/**
 * 首页
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import ArticleCard from '../components/ArticleCard.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

// 获取所有文章并按日期排序
const allWorks = await getCollection('works', ({ data }: CollectionEntry<'works'>) => !data.draft);
const allTutorials = await getCollection('tutorials', ({ data }: CollectionEntry<'tutorials'>) => !data.draft);
const allNotes = await getCollection('notes', ({ data }: CollectionEntry<'notes'>) => !data.draft);

// 合并所有文章并按日期倒序排序
const allArticles = [...allWorks, ...allTutorials, ...allNotes]
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 6);

// 确保 baseUrl 以斜杠结尾
const rawBaseUrl = import.meta.env.BASE_URL;
const baseUrl = rawBaseUrl.endsWith('/') ? rawBaseUrl : `${rawBaseUrl}/`;

// 内容分类统计
const worksCount = allWorks.length;
const tutorialsCount = allTutorials.length;
const notesCount = allNotes.length;
---

<BaseLayout title="首页" description="AI Flow 产品经理的知识库，分享 AI 技术、产品设计和开发实践">
    <!-- Hero 区域 -->
    <section class="relative h-screen flex items-start bg-[var(--color-bg)]">
      <!-- SVG Filter 定义：强力喷雾扩散效果（装饰图形用） -->
      <svg width="0" height="0" class="absolute block">
        <filter id="spray-texture" x="-50%" y="-50%" width="200%" height="200%">
          <feMorphology operator="dilate" radius="4" in="SourceGraphic" result="dilated" />
          <feTurbulence type="fractalNoise" baseFrequency="0.85" numOctaves="4" result="noise" />
          <feDisplacementMap in="dilated" in2="noise" scale="100" xChannelSelector="R" yChannelSelector="G" result="displaced" />
          <feGaussianBlur in="displaced" stdDeviation="0.5" result="blurred" />
          <feComponentTransfer in="blurred">
            <feFuncA type="linear" slope="1.5" intercept="-0.1" />
          </feComponentTransfer>
        </filter>
        
        <!-- 轻度喷雾效果（标题用） -->
        <filter id="spray-texture-light" x="-20%" y="-20%" width="140%" height="140%">
          <feMorphology operator="dilate" radius="1" in="SourceGraphic" result="dilated" />
          <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" result="noise" />
          <feDisplacementMap in="dilated" in2="noise" scale="20" xChannelSelector="R" yChannelSelector="G" result="displaced" />
          <feGaussianBlur in="displaced" stdDeviation="0.5" result="blurred" />
          <feComponentTransfer in="blurred">
            <feFuncA type="linear" slope="1.2" intercept="0" />
          </feComponentTransfer>
        </filter>
      </svg>

      <!-- 装饰图形容器 -->
      <div class="absolute inset-0 pointer-events-none">
        
        <!-- 橙色圆点 - 左侧装饰-->
        <div class="absolute top-[35%] left-[5%] w-16 h-16 md:w-24 md:h-24 rounded-full bg-[var(--color-orange)]" style="filter: url(#spray-texture)"></div>
        <div class="absolute top-[55%] left-[3%] w-12 h-12 md:w-16 md:h-16 rounded-full bg-[var(--color-orange)]" style="filter: url(#spray-texture)"></div>
        
        <!-- 黄色 D 形 - 大尺寸，在左侧 -->
        <div class="absolute top-[30%] left-[10%] transform -rotate-6 select-none pointer-events-none">
          <span 
            class="block font-medium text-[20rem] md:text-[45rem] leading-none text-[var(--color-yellow)] opacity-70"
            style="filter: url(#spray-texture)"
          >
            D
          </span>
        </div>
        
        <!-- 蓝色 D 形 - 中间-->
        <div class="absolute top-[40%] left-[40%] transform -rotate-350 select-none pointer-events-none">
          <span 
            class="block font-medium text-[15rem] md:text-[35rem] leading-none text-[var(--color-blue)] opacity-70"
            style="filter: url(#spray-texture)"
          >
            O
          </span>
        </div>
        
        <!-- 绿色 D 形 - 右侧-->
        <div class="absolute top-[35%] left-[65%] select-none pointer-events-none">
          <span 
            class="block font-medium text-[15rem] md:text-[35rem] leading-none text-[var(--color-green)] opacity-70"
            style="filter: url(#spray-texture)"
          >
            O
          </span>
        </div>

        <!-- 橙色圆点 - 右侧装饰 -->
        <div class="absolute top-[45%] right-[8%] w-12 h-12 md:w-16 md:h-16 rounded-full bg-[var(--color-orange)]" style="filter: url(#spray-texture)"></div>
        <div class="absolute top-[65%] right-[4%] w-20 h-20 md:w-28 md:h-28 rounded-full bg-[var(--color-orange)]" style="filter: url(#spray-texture)"></div>
      </div>
    
    <!-- 主内容 -->
    <div class="w-full z-10 px-6 md:px-12">
      <!-- 标题和描述 - 居中偏上 -->
      <div class="flex flex-col items-center mt-20 text-center">
        <img 
          src={`${baseUrl}logo.svg`}
          alt="AI Flow 4 PM" 
          class="h-24 md:h-32 w-auto mb-8 max-w-full"
          style="filter: url(#spray-texture-light)"
        />
        <p class="text-2xl text-[var(--color-text-secondary)] leading-tight">
          产品经理的 AI 知识库，探索 AI 技术与产品设计的交汇点。记录学习、分享实践、沉淀思考。
        </p>
      </div>

      <!-- 底部导航指引 - 屏幕底部居中 -->
      <div class="absolute bottom-30 left-1/2 transform -translate-x-1/2">
        <a 
          href="#latest-content"
          class="group flex flex-col items-center gap-2 text-2xl font-medium text-[var(--color-text)] transition-colors"
        >
          <span class="border-b-2 group-hover:text-[var(--color-orange)] transition-colors">开始探索</span>
          <svg class="w-6 h-6 group-hover:translate-y-1 group-hover:stroke-[var(--color-orange)] transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- 最新内容区域 -->
  <section id="latest-content" class="py-20 md:py-28 bg-[var(--color-bg)]">
    <div class="max-w-6xl mx-auto px-6 md:px-10">
      <!-- 标题区域 -->
      <div class="flex items-end justify-between mb-12">
        <div>
          <h2 class="text-2xl md:text-4xl font-bold text-[var(--color-text)] mb-2">
            最新内容
          </h2>
        </div>
        <a 
          href={`${baseUrl}posts`}
          class="text-xl md:flex items-center gap-2 text-[var(--color-text-secondary)] hover:text-[var(--color-orange)] transition-colors font-medium"
        >
          <span>查看全部</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>
      
      <!-- 文章列表 -->
      {allArticles.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {allArticles.map((article) => (
            <ArticleCard 
              title={article.data.title}
              description={article.data.description}
              date={article.data.date}
              tags={article.data.tags}
              href={`${baseUrl}posts/${article.id}`}
              cover={article.data.cover}
              template={article.data.template}
            />
          ))}
        </div>
      ) : (
        <div class="text-center py-24 bg-white rounded-3xl">
          <div class="w-20 h-20 rounded-full bg-[var(--color-yellow)]/20 flex items-center justify-center mx-auto mb-6">
            <span class="text-4xl">✨</span>
          </div>
          <p class="text-[var(--color-text-secondary)] text-xl mb-3">
            内容正在准备中...
          </p>
          <p class="text-[var(--color-text-muted)] text-sm">
            在 <code class="bg-[var(--color-bg)] px-2 py-1 rounded text-sm font-mono">src/content/</code> 目录下创建 Markdown 文件开始创作
          </p>
        </div>
      )}

      <!-- 移动端查看全部按钮 -->
      {allArticles.length > 0 && (
        <div class="mt-10 text-center md:hidden">
          <a 
            href={`${baseUrl}posts`}
            class="inline-flex items-center gap-2 px-8 py-4 rounded-full bg-white text-[var(--color-text)] font-medium hover:shadow-lg transition-all"
          >
            <span>查看全部</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </div>
      )}
    </div>
  </section>

  <!-- 底部区域 -->
  <footer class="py-12 relative">
  </footer>
</BaseLayout>
